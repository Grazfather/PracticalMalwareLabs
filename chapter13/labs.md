## Lab 13-1
### Basic Static Analysis
- **strings**: The standard base64 alphabet, "Mozilla/4.0", "http://%s/%s/", some prints regarding dialog boxes, and "%02x".
- **PEiD**: Microsoft Visual C++ 6.0.
- **Dependency Walker**: import from WININET.DLL to grab files from the internet, 'gethostname', 'WSAStartup', and 'WSACleanup' from WS2_32.DLL, and a handful from KERNEL32.DLL including 'WriteFile'.
- **PEview**: Normal section names and headers, but includes a .rsrc section.
- **Resource Hacker** (Because of the presence of 'FindResourceA' and the .rsrc section): A single resource named "RCData", which appears to be encrypted in some way.

### Basic Dynamic Analysis
Running the malware with procmon and regshot running we see it attempt to make outgoing connections to ip "192.0.78.25". Nothing interesting was written to the registry, and the process seems to stick around in a console window until I kill it explicitly.

### Advanced Dynamic/Static Analysis
Because these is presumably some decrypting going on and I don't want to have to dig through all the code manually I went ahead with dynamic analysis using OllyDBG. Loading it up (having to pass an access violation exception for some reason) I point breakpoints on a few points of interest. Notably where the string "http://%s/%s/" was used as well as 'InternetOpenUrlA'. I see that the URL requested was "http://www.practicalmalwareanalysis.com/cmVwYw==". Tracing back I see that the base64 alphabet is actually used to encode strings (which explains why we didn't see any base64 encoded strings in the binary: We _encode_ only. No base64 decoding). The domain name wasn't in the binary, so it's presumably encrypted, probably in the 'RCData' resource.

Looking back further we can see where the base64 encoded string came from. There's a call to 'gethostname' which returns "repc" ("reverse engineering pc" is probably what I meant when I set up the VM). sub_4010B1 is passed the hostname and the base64 encoding is copied to the provided buffer.

Tracing back where the hostname came from, we see that there is a loop immediately after a call to 'LoadResource'. Loading the binary in IDA and searching for 'xor's indeed shows many calls to xor, but most are xoring a register with itself (clearing it out) and only one is xoring with a constant. In sub_401190 we see the xor of eax with 0x3B and it is indeed in the same loop we saw in OllyDBG. Stepping through this loop we can see that the resource that was loaded earlier is simply encrypted with a single byte key (0x3B) XOR cipher.

Looking into the base64 encoding implementation, you can see a few references to the alphabet using KANAL with PEiD: There are references at 0x401013, 0x40103E, 0x40106E, and 0x401097. These locations are in sub_401000, whose only call is from sub_4010B1, which is called soon after the call to 'gethostname'. The function probably isn't worth looking into, but we can play with it by placing a breakpoint at 0x40122A and modifying the string that is passed to the encode function. While playing around the only thing I noticed of note is that it won't encode more than 12 characters.

Jumping back to the web request, we see that it simply checks the first byte of the response and returns 1 if it's 'o' and 0 otherwise. This malware doesn't seem to do anything other than advertise that it's running on a host by making a GET request to its C&C server with the (possibly truncated) base64 encoded hostname of the machine it's running on.

### Questions
1. The notable string addition is the hostname "www.practicalmalwareanalysis.com", which comes from the encrypted ciphertext found in the resource section.
2. The hostname was decrypted from the resource section with a simple XOR cipher.
3. The key is the single byte '0x3B' and the scheme is a simple XOR cipher.
4. FindCrypt2 didn't work with IDA, but KANAL found references to the base64 alphabet and helped identify the base64encode function.
5. base64 encoding is used to determine the path used in the 'InternetOpenUrlA' call.
6. sub_4010B1.
7. The function doesn't appear to encoding anything longer than 12 bytes.
8. Yes. sub_4010B1 is a standard base64 encoding function.
9. The malware doesn't appear to do anything more than send this specially-encoded request and wait for a response.
