# Lab 20

## Lab 20-1
### Basic Static Analysis
- **strings**: "empdownload.exe", "http://www.practicalmalwareanalysis.com/cpp.html", plus C++ error messages.
- **PEiD**: Microsoft Visual C++ 6.0.
- **Dependency Walker**: `URLDownloadToFileA` from URLMON.DLL, many from KERNEL32.DLL, including `WriteFile`, `LoadLibraryA`, and `VirtualAlloc`.
- **PEview**: Normal section names and headers.

### Basic Dynamic Analysis
Starting up Process Monitor and running the malware we can see connections made to 192.0.78.24 over http. This appears to be the IP address of www.practicalmalwareanalysis.com at the time of this writing. After this the process seems to end immediately. Setting up fakedns and `nc` to catch the request, we see it's a simple GET for _cpp.html_, which we've seen in the string.

### Advanced Static Analysis
Popping the binary into IDA we see a call to `new`, creating a _uint_. Its address is stored to two locals on the stack, and then the address of the URL is stored at the start of the returned object. The address of this object is then copied into ecx and `sub_401040` is called, provided no args, but if we look into its body we see that ecx is used. This function simply reads out the pointer from the object and then calls `URLDownloadToFileA` with a target of "c:\tempdownload.exe".

### Questions
1. Yes, it takes a single object (`this`) in ecx.
2. "http://wwww.practicalmalwareanalysis.com/cpp.html", whose pointer was stored in the object we called the method on.
3. The program downloads the file to "c:\tempdownload.exe". `strings` got the string above ("empdownload" incorrect for some reason.
